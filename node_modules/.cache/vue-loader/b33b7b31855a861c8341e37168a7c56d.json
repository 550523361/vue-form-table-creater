{"remainingRequest":"/Users/iriskang/xkfeng/formAndTableCreater/vue-form-table-creater/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/iriskang/xkfeng/formAndTableCreater/vue-form-table-creater/src/components/formCreater/chooseBtn.vue?vue&type=style&index=1&lang=css&","dependencies":[{"path":"/Users/iriskang/xkfeng/formAndTableCreater/vue-form-table-creater/src/components/formCreater/chooseBtn.vue","mtime":1553655008322},{"path":"/Users/iriskang/xkfeng/formAndTableCreater/vue-form-table-creater/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/Users/iriskang/xkfeng/formAndTableCreater/vue-form-table-creater/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/iriskang/xkfeng/formAndTableCreater/vue-form-table-creater/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/iriskang/xkfeng/formAndTableCreater/vue-form-table-creater/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/iriskang/xkfeng/formAndTableCreater/vue-form-table-creater/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.tableNoBorder .el-table::before,\n.tableNoBorder .el-table::after {\n  height: 0px;\n}\n.tableNoBorder .el-table--border td,\n.tableNoBorder .el-table {\n  border: 0px solid #00a0ef;\n}\n",{"version":3,"sources":["chooseBtn.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAweA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"chooseBtn.vue","sourceRoot":"src/components/formCreater","sourcesContent":["<!--\n    选择按钮 显示为一个弹窗或者一个分页列表 选择结果通过dataBus同步出去 通过简单的配置可以做到快速完成数据展示和选择,支持分页选择功能支持选择后自定义显示\n-->\n<template>\n  <div :style=\"{\n        width:config.width||'800px'\n    }\" :class=\"{'tableNoBorder':false}\">\n    <el-button\n      type=\"info\"\n      v-if=\"config.isPop&&!config.readonly\"\n      style=\"margin-bottom: 20px;\"\n      @click=\"addCommunity\"\n    >{{config.chooseBtnLabel}}</el-button>\n    <div class=\"chooseResultContainer\" v-if=\"!config.chooseResultViewHandler\">\n      <span\n        class=\"addInputItemGroupContainer\"\n        v-for=\"(group,index) in Object.keys(choosedResultArray)\"\n        :key=\"'groupContainer'+group+'_'+index\"\n      >\n        <span\n          v-if=\"group!='undefined'\"\n          style=\"font-weight: bold;margin-right: 10px;min-width: 50px;text-align: right;display: inline-block;\"\n        >{{group==\"undefined\"?'':group}}</span>\n        <span\n          class=\"addInputItemContainer\"\n          v-for=\"(item,index) in choosedResultArray[group]\"\n          :key=\"'groupContainerItem'+item+'_'+index\"\n        >\n          <span\n            class=\"deleteIcon\"\n            v-if=\"!config.readonly&&$attrs.config.simpleDelBtn!=false&&item.name\"\n            @click=\"deleteItem(item,index)\"\n          >×</span>\n          {{item.name}}\n        </span>\n      </span>\n    </div>\n    <div class=\"chooseResultContainer\" v-if=\"config.chooseResultViewHandler\">\n      <div v-html=\"config.chooseResultViewHandler(choosedResultArray,config.readonly)\"></div>\n    </div>\n\n    <el-dialog\n      v-if=\"config.isPop\"\n      :title=\"config.popTitle||''\"\n      :visible.sync=\"confirmRefund\"\n      :width=\"config.width||'40%'\"\n      :before-close=\"handleClose\"\n    >\n      <list-table\n        v-if=\"!config.readonly && showSearch\"\n        :config=\"{tableListConfig,queryConfig,clickHandler,form:'propertyMerchant'}\"\n        :readData=\"readonly\"\n        ref=\"tableList\"\n      >\n        <div class=\"chooseResultContainer\" slot=\"beforeTable\" v-if=\"config.popChooseViewHandler\">\n          <div v-html=\"config.popChooseViewHandler(choosedResultArray)\"></div>\n        </div>\n        <div slot=\"afterTable\">\n          <div style=\"text-align: center;\">\n            <el-button @click=\"handleClose\">保存</el-button>\n          </div>\n        </div>\n      </list-table>\n    </el-dialog>\n    <div v-else>\n      <list-table\n        v-if=\"!config.readonly && showSearch\"\n        :config=\"{tableListConfig,queryConfig,clickHandler,form:'propertyMerchant'}\"\n        :readData=\"readonly\"\n        ref=\"tableList\"\n      >\n        <div slot=\"afterTable\"></div>\n      </list-table>\n    </div>\n  </div>\n</template>\n<script>\nimport baseTableConfig from \"./../tableList/TabListConfig\";\nimport listTable from \"./../tableList/listTable\";\nimport _ from \"lodash\";\n\nlet tableListConfig = JSON.parse(JSON.stringify(baseTableConfig));\nlet baseBtnStyle = tableListConfig.baseBtnStyle;\ntableListConfig.query = {\n  pageNum: 1,\n  pageSize: 15\n};\nexport default {\n  name: \"choose-btn\",\n  components: {\n    \"list-table\": listTable\n  },\n  data() {\n    return {\n      confirmRefund: false,\n      showSearch: true,\n      config: {},\n      items: [],\n      readonly: {},\n      tableListConfig: {\n        showHeader: true,\n        stripe: true,\n        operator: { width: \"800px\", columns: [] },\n        pager: { query: { pageSize: 5 } }\n      },\n      queryConfig: {},\n      chooseResult: {},\n      catchListData: {}\n    };\n  },\n  methods: {\n    addCommunity() {\n      this.confirmRefund = true;\n    },\n    handleClose() {\n      this.confirmRefund = false;\n    },\n    chooseAllClick(items, index) {\n      console.log(\"chooseAllClick\", items);\n      let that = this;\n      that.chooseResult = {};\n      if (this.config.dataBus) {\n        if (typeof this.config.dataBus === \"function\") {\n          this.config.dataBus(\n            this.config,\n            items.map(item => {\n              that.chooseResult[item.id] = item;\n              return item.id;\n            })\n          );\n        }\n      }\n    },\n    clickHandler(param, btnInfo, chooseData) {\n      //console.log(\"index --99000- clickHandler\",param,btnInfo,chooseData)\n      this.$nextTick();\n    },\n    clickChooseCommunityHandler(param, btnInfo, chooseData) {\n      let that = this;\n      // this.chooseAllClick()\n      this.$nextTick(function() {\n        if (!param.idCheck) {\n          let deleteResult = this.deleteItem(param);\n          console.log(\"deleteResult\", deleteResult);\n          if (deleteResult instanceof Promise) {\n            deleteResult.then(\n              success => {\n                //console.log(\"deleteResult success\",success)\n                if (success) {\n                  param.idCheck = true;\n                }\n              },\n              error => {\n                //console.log(\"deleteResult error\",error)\n              }\n            );\n          }\n        } else {\n          let addResult = that.addItem(param);\n          //console.log(\"addResult\",addResult)\n          if (addResult instanceof Promise) {\n            addResult.then(\n              success => {\n                //console.log(\"addResult success\",success)\n                if (success) {\n                  param.idCheck = true;\n                  that.chooseResult[param.id] = param;\n                  that.syncData();\n                }\n              },\n              error => {\n                //console.log(\"addResult error\",error)\n              }\n            );\n          } else {\n            that.chooseResult[param.id] = param;\n            that.syncData();\n          }\n        }\n      });\n    },\n    clickConfig(param) {\n      console.log(\"clickConfig***++++++*****\", param);\n    },\n    check: function(queryParam) {\n      if (queryParam) {\n        var communityName = queryParam.communityName || \"\";\n        communityName = communityName.replace(/^\\s+/, \"\").replace(/\\s+$/, \"\");\n        if (communityName == \"\") {\n          return true;\n        }\n      }\n      return true;\n    },\n    pagerDataHelper(param) {\n      let callback = this.config.tableListConfig.pagerDataHelper;\n      let that = this;\n      if (callback && typeof callback == \"function\") {\n        param = callback(param);\n      }\n      param.content.map(item => {\n        item.idCheck = that.chooseResult[item.id] ? true : false;\n      });\n      that.catchListData = param.content;\n      //console.log(\"pagerDataHelper\",param)\n      return param;\n    },\n    uncheckItem(deleteItem) {\n      let that = this;\n      if (that.catchListData.length) {\n        console.log(\"that.catchListData\", that.catchListData);\n        that.catchListData.forEach(item => {\n          if (item.id == deleteItem.id) {\n            item.idCheck = false;\n          }\n        });\n      }\n    },\n    checkItem(addItem) {\n      let that = this;\n      if (that.catchListData.length) {\n        console.log(\"that.catchListData\", that.catchListData);\n        that.catchListData.forEach(item => {\n          if (item.id == addItem.id) {\n            item.idCheck = true;\n          }\n        });\n      }\n    },\n    addItem(item, index) {\n      let that = this;\n      if (that.config.beforeAdd && typeof that.config.beforeAdd == \"function\") {\n        let checkResult = that.config.beforeAdd(item, index);\n        if (checkResult instanceof Promise) {\n          return checkResult.then(\n            success => {\n              that.chooseResult[item.id] = item;\n              that.checkItem(item);\n              that.syncData();\n            },\n            error => {\n              if (!error.msg) return;\n              that.$message({\n                type: \"error\",\n                message: error.msg\n              });\n              return error;\n            }\n          );\n        } else if (checkResult) {\n          that.chooseResult[item.id] = item;\n          that.checkItem(item);\n          that.syncData();\n        }\n      } else {\n        that.chooseResult[item.id] = item;\n        that.checkItem(item);\n        that.syncData();\n      }\n    },\n    deleteItem(item, index) {\n      let that = this;\n      if (\n        that.config.beforeDelete &&\n        typeof that.config.beforeDelete == \"function\"\n      ) {\n        let checkResult = that.config.beforeDelete(item, index);\n        if (checkResult instanceof Promise) {\n          return checkResult.then(\n            success => {\n              delete that.chooseResult[item.id];\n              console.log(\"deleteItem\", item, success);\n              that.uncheckItem(item);\n              that.syncData();\n            },\n            error => {\n              if (!error.msg) return;\n              that.$message({\n                type: \"error\",\n                message: error.msg\n              });\n              return error;\n            }\n          );\n        } else if (checkResult) {\n          delete that.chooseResult[item.id];\n          that.uncheckItem(item);\n          that.syncData();\n        }\n      } else {\n        delete that.chooseResult[item.id];\n        that.uncheckItem(item);\n        that.syncData();\n      }\n    },\n    syncData() {\n      let that = this;\n      that.$nextTick(function() {\n        that.chooseResult = JSON.parse(JSON.stringify(that.chooseResult));\n        if (that.config.dataBus) {\n          if (typeof that.config.dataBus === \"function\") {\n            that.config.dataBus(\n              that.config,\n              Object.values(that.chooseResult)\n                .filter(item => item != null)\n                .map(item => {\n                  return item.id;\n                })\n            );\n          }\n        }\n      });\n    },\n    headerClick(column, eventData, listData) {\n      //console.log(\"headerClick***++++++*****\",column,eventData,listData);\n      column.label = column.label == \"取消\" ? \"全选\" : \"取消\";\n      listData.content &&\n        listData.content.map(item => (item[\"idCheck\"] = !item.idCheck));\n    }\n  },\n  computed: {\n    choosedResultArray: function() {\n      return _.groupBy(\n        Object.values(this.chooseResult),\n        this.config.groupBy || \"provinceName\"\n      );\n    }\n  },\n  created() {\n    let that = this;\n    let readonly = this.$attrs.readData;\n    that.readonly = readonly;\n    //console.log(\"readonly\",this.$attrs)\n    that.$watch(\n      \"readonly\",\n      function(newData, oldData) {\n        console.log(\"chooseBtn newData,oldData\", newData, oldData, that.$attrs);\n      },\n      {\n        deep: true\n      }\n    );\n    let config = this.$attrs.config;\n    //console.log(\"config\",config);\n    this.config = config;\n    let formData = config.formData;\n    if (formData) {\n      (formData || []).forEach(item => {\n        item.from = \"db\";\n        that.chooseResult[item.id] = item;\n      });\n      if (this.config.dataBus) {\n        console.log(\"that.chooseResult*******\", that.chooseResult);\n        if (typeof this.config.dataBus === \"function\") {\n          that.config.dataBus(\n            that.config,\n            Object.values(that.chooseResult)\n              .filter(item => item != null)\n              .map(item => {\n                return item.id;\n              })\n          );\n        }\n      }\n    }\n\n    if (this.$attrs.config.watchFormData) {\n      this.$watch(\n        \"$attrs.config.formData\",\n        function(newValue, oldValue) {\n          let formData = newValue;\n          that.chooseResult = {};\n          if (formData) {\n            (formData || []).forEach(item => {\n              item.from = \"db\";\n              that.chooseResult[item.id] = item;\n            });\n            if (this.config.dataBus) {\n              console.log(\"that.chooseResult*******\", \"formData\", newValue);\n              if (typeof this.config.dataBus === \"function\") {\n                that.config.dataBus(\n                  that.config,\n                  Object.values(that.chooseResult)\n                    .filter(item => item != null)\n                    .map(item => {\n                      return item.id;\n                    })\n                );\n              }\n            }\n            that.chooseResult = JSON.parse(JSON.stringify(that.chooseResult));\n          }\n        },\n        {\n          deep: false\n        }\n      );\n    }\n\n    //tableListConfig.selection=true;\n    tableListConfig.headerClick = that.headerClick;\n    tableListConfig.url = that.config.tableListConfig.url;\n    tableListConfig.stripe = that.config.tableListConfig.stripe;\n    tableListConfig.showHeader = that.config.tableListConfig.showHeader;\n    tableListConfig.columns = that.config.tableListConfig.columns || [];\n    tableListConfig.method =\n      this.$attrs.config.tableListConfig.method || \"post\";\n    tableListConfig.selection =\n      this.$attrs.config.tableListConfig.selection || false;\n    if (this.$attrs.config.tableListConfig.pager) {\n      tableListConfig.pager.pageSize = this.$attrs.config.tableListConfig.pager.pageSize;\n    }\n    this.queryConfig.queryElements = config.tableListConfig.queryElements || [];\n    tableListConfig.operator = (config.tableListConfig.operator &&\n    config.tableListConfig.operator.length > 0\n      ? config.tableListConfig.operator\n      : false) || {\n      width: 100,\n      columns: [\n        {\n          prop: \"id\",\n          label: \"选择\",\n          type: \"checkbox\",\n          click: that.clickChooseCommunityHandler,\n          style: Object.assign(JSON.parse(JSON.stringify(baseBtnStyle)), {\n            backgroundColor: \"#97a8be\",\n            color: \"#fff\"\n          }),\n          checkedStyle: Object.assign(\n            JSON.parse(JSON.stringify(baseBtnStyle)),\n            { backgroundColor: \"#000\", color: \"#fff\" }\n          )\n        }\n      ]\n    };\n    tableListConfig.pagerDataHelper = that.pagerDataHelper;\n    tableListConfig.chooseAllClick =\n      config.tableListConfig.chooseAllClick || that.chooseAllClick;\n    that.tableListConfig = Object.assign(that.tableListConfig, tableListConfig);\n  }\n};\n</script>\n\n<style scoped>\n#container {\n  height: 300px;\n  width: 750px;\n}\n\n.queryElement {\n  display: block;\n  width: 100%;\n  border: 0px solid #f00;\n}\n.addInputItemContainer {\n  display: inline-block;\n  padding: 5px 10px;\n  border: 1px solid #00c9ff;\n  border-radius: 5px;\n  color: #00c9ff;\n  line-height: 20px;\n  margin-right: 10px;\n  margin-bottom: 10px;\n  position: relative;\n}\n.deleteIcon {\n  display: inline-block;\n  position: absolute;\n  right: -8px;\n  top: -8px;\n  width: 16px;\n  height: 16px;\n  line-height: 16px;\n  font-size: 12px;\n  font-weight: bold;\n  text-align: center;\n  background: #f00;\n  color: #fff;\n  border-radius: 50%;\n  cursor: pointer;\n}\n.addInputItemGroupContainer {\n  display: block;\n  text-align: left;\n  margin-bottom: 10px;\n}\n</style>\n<style>\n.tableNoBorder .el-table::before,\n.tableNoBorder .el-table::after {\n  height: 0px;\n}\n.tableNoBorder .el-table--border td,\n.tableNoBorder .el-table {\n  border: 0px solid #00a0ef;\n}\n</style>\n"]}]}